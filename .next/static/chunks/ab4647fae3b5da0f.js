(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65850,e=>{e.v({createOrderButton:"listSelectedProducts-module__q4pPKW__createOrderButton",header:"listSelectedProducts-module__q4pPKW__header",listContainer:"listSelectedProducts-module__q4pPKW__listContainer",removeButton:"listSelectedProducts-module__q4pPKW__removeButton",total:"listSelectedProducts-module__q4pPKW__total",totalProduct:"listSelectedProducts-module__q4pPKW__totalProduct"})},28478,e=>{e.v({card:"SacoUi-module__5iaeka__card",info:"SacoUi-module__5iaeka__info"})},74647,e=>{"use strict";var r=e.i(43476),t=e.i(71645);let o=({product:e,onQuantityChange:t,quantity:o})=>(0,r.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:(0,r.jsx)("button",{style:{backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"5px",padding:"10px",cursor:"pointer",fontSize:"1rem",width:"auto",height:"40px",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>t(e,o+1),children:o>0?`agregar otro (${o})`:"agregar"})}),i=({products:e,Card:t,onQuantityChange:i,selectedProducts:s})=>{let l={display:"flex",alignItems:"stretch",justifyContent:"space-between",gap:"1rem"},n={fontWeight:"bold",color:"#0070f3",fontSize:"1.2rem",marginTop:"12px"},c={fontWeight:"bold"};return e?.length===0?(0,r.jsx)("h2",{children:" No se encontraron productos que coincidan "}):(0,r.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:e?.map(e=>(0,r.jsx)("div",{style:l,children:(0,r.jsx)("div",{style:{flexGrow:1},children:(0,r.jsxs)(t,{product:e,children:[(0,r.jsxs)("p",{style:n,children:[(0,r.jsx)("span",{style:c,children:"Precio:"})," $",e.precioPublico]}),(0,r.jsx)("div",{style:{textAlign:"right",display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,r.jsx)(o,{product:e,onQuantityChange:i,quantity:s.find(r=>r.product.id===e.id)?.quantity||0})})]})})},e.id))})};e.i(36180);var s=e.i(98925),l=e.i(41187);let n=(0,s.getFirestore)(l.default),c=async e=>{try{let r=(0,s.collection)(n,"ingresos"),t=(0,s.query)(r,(0,s.where)("initialsNames","array-contains",e)),o=await (0,s.getDocs)(t),i=[];return o.forEach(e=>{i.push({id:e.id,...e.data()})}),i}catch(e){return console.log("Error al buscar en Firestore:",e.message),[]}},a=async e=>(console.log(e),await c(e)),d=({onSearchResults:e,setIsLoading:t})=>{let o=async r=>{r.preventDefault();let o=r.target.elements.searchTerm.value;if(o){t(!0),console.log(`Buscando en 'initialsNames' el valor: ${o}`);try{let r=await a(o);console.log("Resultados encontrados:",r),e(r)}catch(r){console.error("Error al buscar productos:",r),e([])}finally{t(!1)}}},i={padding:"0.5rem 1rem",borderRadius:"4px",border:"none",backgroundColor:"#0070f3",color:"white",cursor:"pointer"};return(0,r.jsxs)("form",{style:{width:"100%",display:"flex",gap:"0.5rem"},onSubmit:o,onReset:r=>{e([])},children:[(0,r.jsx)("button",{type:"reset",style:{...i,backgroundColor:"#6c757d"},children:"Limpiar"}),(0,r.jsx)("input",{type:"text",name:"searchTerm",style:{flexGrow:1,padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},placeholder:"Buscar..."}),(0,r.jsx)("button",{type:"submit",style:i,children:"Buscar"})]})},u=({product:e,onQuantityChange:t,quantity:o})=>{let i={backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"5px",padding:"10px",cursor:"pointer",fontSize:"1rem",width:"40px",height:"40px",display:"flex",justifyContent:"center",alignItems:"center"};return(0,r.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,r.jsx)("button",{style:i,onClick:()=>t(e,o-1),children:"-"}),(0,r.jsx)("input",{type:"number",style:{width:"50px",textAlign:"center",fontSize:"1rem",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},value:o,onChange:r=>t(e,parseInt(r.target.value,10)||0)}),(0,r.jsx)("button",{style:i,onClick:()=>t(e,o+1),children:"+"})]})},p=({product:e,selectedPrice:t,onPriceChange:o})=>(0,r.jsx)("select",{style:{padding:"8px",borderRadius:"4px",border:"1px solid #ccc",backgroundColor:"white",fontSize:"1rem",minWidth:"200px"},value:t.type,onChange:r=>{let t=r.target.value,i=e[t];o(e.id,{type:t,price:i})},children:[{value:"precioPublico",label:"Precio Publico"},{value:"precioComerciante",label:"Precio Comerciante"},{value:"preciox5sacos",label:"Precio x 5 sacos"},{value:"preciox10sacos",label:"Precio x 10 sacos"},{value:"preciox15sacos",label:"Precio x 15 sacos"}].map(t=>(0,r.jsxs)("option",{value:t.value,children:[t.label,": $",e[t.value]]},t.value))});var x=e.i(65850);let h=({selectedProducts:e,Card:t,onQuantityChange:o,onPriceChange:i,onRemoveProduct:s,handlerCrearPedido:l})=>{let n=e.filter(e=>e.quantity>0),c=n.reduce((e,{product:r,quantity:t})=>e+(r.selectedPrice?r.selectedPrice.price:r.precioPublico)*t,0);return 0===n.length?null:(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:x.default.header,children:(0,r.jsx)("h2",{children:"Productos Seleccionados"})}),(0,r.jsxs)("div",{className:x.default.total,children:["Total General: $",c.toFixed(2)]}),(0,r.jsx)("div",{className:x.default.listContainer,children:n.map(({product:e,quantity:l})=>{let n=(e.selectedPrice?e.selectedPrice.price:e.precioPublico)*l;return(0,r.jsx)("div",{children:(0,r.jsxs)(t,{product:e,children:[(0,r.jsx)(p,{product:e,selectedPrice:e.selectedPrice||{type:"precioPublico",price:e.precioPublico},onPriceChange:i}),(0,r.jsxs)("div",{style:{textAlign:"right",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,r.jsx)(u,{product:e,onQuantityChange:o,quantity:l}),(0,r.jsxs)("p",{className:x.default.totalProduct,children:["Subtotal: $",n.toFixed(2)]}),(0,r.jsx)("button",{onClick:()=>s(e),className:x.default.removeButton,children:"Quitar"})]})]})},e.id)})}),(0,r.jsx)("div",{className:x.default.header,style:{margin:"1rem 0"},children:(0,r.jsx)("button",{className:x.default.createOrderButton,onClick:l,children:"Crear pedido"})})]})},m=(0,s.getFirestore)(l.default),y=async(e,r)=>{try{let t=(0,s.doc)(m,"ingresos",e);return await (0,s.updateDoc)(t,{amount:(0,s.increment)(-r)}),{success:!0,message:`Amount updated for document ${e}`}}catch(e){return console.error("Error updating document:",e),{success:!1,error:e.message}}},g=(0,s.getFirestore)(l.default),f=async(e,r)=>{try{if(!Array.isArray(e)||0===e.length)throw Error("El pedido debe ser un array con al menos un producto.");let t=await (0,s.addDoc)((0,s.collection)(g,"pedidos"),{client:r,products:e,createdAt:(0,s.serverTimestamp)()});return{success:!0,id:t.id}}catch(e){return console.error("Error adding document: ",e),{success:!1,error:e.message}}},b=async(e,r)=>{console.log(e);try{if(!Array.isArray(e))return{success:!1,error:"newPedido must be an array"};let t=e.map(e=>e.product.id&&"number"==typeof e.quantity?y(e.product.id,e.quantity):Promise.reject(Error("Each item in newPedido must have an id and a numeric monto."))),o=await Promise.all(t);await f(e,r);let i=o.filter(e=>!e.success);if(i.length>0)return{success:!1,message:"Some updates failed",errors:i};return{success:!0,message:"All pedidos processed successfully"}}catch(e){return console.error("Error processing new pedido:",e),{success:!1,error:e.message}}};var j=e.i(28478);let v=({product:e,children:t})=>{let o={margin:"8px 0",color:"#333",fontSize:"1rem"},i={fontWeight:"bold"};return(0,r.jsxs)("div",{className:j.default.card,children:[(0,r.jsxs)("div",{className:j.default.info,children:[(0,r.jsxs)("p",{style:o,children:[(0,r.jsx)("span",{style:i,children:"Nombre:"})," ",e.nombre]}),(0,r.jsxs)("p",{style:o,children:[(0,r.jsx)("span",{style:i,children:"Peso:"})," ",e.peso]}),t[0]]}),(0,r.jsx)("div",{children:t[1]})]},e.id)};var P=e.i(61682);function C(){let[e,o]=(0,t.useState)(null),[s,l]=(0,t.useState)([]),[n,c]=(0,t.useState)(!1),[a,u]=(0,t.useState)(!1),[p,x]=(0,t.useState)(!1),m=(e,r)=>{let t=Math.max(0,r);l(r=>{let o=r.findIndex(r=>r.product.id===e.id),i=[...r];if(o>-1)t>0?i[o].quantity=t:i.splice(o,1);else if(t>0){let r="precioPublico",o=e[r];i.push({product:{...e,selectedPrice:{type:r,price:o}},quantity:t})}return i})},y=async()=>{let e=prompt("¿Para quién es este pedido?");if(e){x(!0);try{let r=await b(s,e);console.log(r),alert("Pedido creado con éxito!"),l([]),c(!1)}catch(e){console.error("Error al crear el pedido:",e),alert("Hubo un error al crear el pedido. Por favor, inténtalo de nuevo.")}finally{x(!1)}}},g={backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"5px",padding:"10px 15px",cursor:"pointer",fontSize:"1rem",marginBottom:"1rem"};return(0,r.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",padding:"1rem 0",overflowY:"auto"},children:[p&&(0,r.jsx)(P.default,{}),(0,r.jsx)("div",{style:{flexGrow:1,overflowY:"auto",marginBottom:"3rem"},children:n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("button",{style:g,onClick:()=>c(!1),children:"Volver a Productos"}),(0,r.jsx)(h,{selectedProducts:s,Card:v,onQuantityChange:m,onPriceChange:(e,r)=>{l(t=>t.map(t=>t.product.id===e?{...t,product:{...t.product,selectedPrice:r}}:t))},onRemoveProduct:e=>{window.confirm(`\xbfEst\xe1s seguro de que quieres quitar ${e.nombre} de la lista?`)&&m(e,0)},handlerCrearPedido:y})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,r.jsx)("h1",{children:"Productos Disponibles"}),(0,r.jsxs)("button",{style:g,onClick:()=>c(!0),children:["Ver Seleccionados (",s.reduce((e,r)=>e+r.quantity,0),")"]})]}),a?(0,r.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,r.jsx)(P.default,{})}):(0,r.jsx)(i,{products:e,Card:v,onQuantityChange:m,selectedProducts:s})]})}),!n&&(0,r.jsx)("div",{style:{padding:"1rem 0",width:"100%",position:"fixed",bottom:0},children:(0,r.jsx)(d,{onSearchResults:o,setIsLoading:u})})]})}e.s(["default",()=>C],74647)}]);