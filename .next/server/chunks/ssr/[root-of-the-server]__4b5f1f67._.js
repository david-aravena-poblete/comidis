module.exports=[35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},31073,a=>{a.v({createOrderButton:"listSelectedProducts-module__q4pPKW__createOrderButton",header:"listSelectedProducts-module__q4pPKW__header",listContainer:"listSelectedProducts-module__q4pPKW__listContainer",removeButton:"listSelectedProducts-module__q4pPKW__removeButton",total:"listSelectedProducts-module__q4pPKW__total",totalProduct:"listSelectedProducts-module__q4pPKW__totalProduct"})},93580,a=>{a.v({card:"SacoUi-module__5iaeka__card",info:"SacoUi-module__5iaeka__info"})},85690,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=({product:a,onQuantityChange:c,quantity:d})=>(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:(0,b.jsx)("button",{style:{backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"5px",padding:"10px",cursor:"pointer",fontSize:"1rem",width:"auto",height:"40px",display:"flex",justifyContent:"center",alignItems:"center"},onClick:()=>c(a,d+1),children:d>0?`agregar otro (${d})`:"agregar"})}),e=({products:a,Card:c,onQuantityChange:e,selectedProducts:f})=>{let g={display:"flex",alignItems:"stretch",justifyContent:"space-between",gap:"1rem"},h={fontWeight:"bold",color:"#0070f3",fontSize:"1.2rem",marginTop:"12px"},i={fontWeight:"bold"};return a?.length===0?(0,b.jsx)("h2",{children:" No se encontraron productos que coincidan "}):(0,b.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:a?.map(a=>(0,b.jsx)("div",{style:g,children:(0,b.jsx)("div",{style:{flexGrow:1},children:(0,b.jsxs)(c,{product:a,children:[(0,b.jsxs)("p",{style:h,children:[(0,b.jsx)("span",{style:i,children:"Precio:"})," $",a.precioPublico]}),(0,b.jsx)("div",{style:{textAlign:"right",display:"flex",flexDirection:"column",justifyContent:"center"},children:(0,b.jsx)(d,{product:a,onQuantityChange:e,quantity:f.find(b=>b.product.id===a.id)?.quantity||0})})]})})},a.id))})};a.i(69387);var f=a.i(60574),g=a.i(21467);let h=(0,f.getFirestore)(g.default),i=async a=>{try{let b=(0,f.collection)(h,"ingresos"),c=(0,f.query)(b,(0,f.where)("initialsNames","array-contains",a)),d=await (0,f.getDocs)(c),e=[];return d.forEach(a=>{e.push({id:a.id,...a.data()})}),e}catch(a){return console.log("Error al buscar en Firestore:",a.message),[]}},j=async a=>(console.log(a),await i(a)),k=({onSearchResults:a,setIsLoading:c})=>{let d=async b=>{b.preventDefault();let d=b.target.elements.searchTerm.value;if(d){c(!0),console.log(`Buscando en 'initialsNames' el valor: ${d}`);try{let b=await j(d);console.log("Resultados encontrados:",b),a(b)}catch(b){console.error("Error al buscar productos:",b),a([])}finally{c(!1)}}},e={padding:"0.5rem 1rem",borderRadius:"4px",border:"none",backgroundColor:"#0070f3",color:"white",cursor:"pointer"};return(0,b.jsxs)("form",{style:{width:"100%",display:"flex",gap:"0.5rem"},onSubmit:d,onReset:b=>{a([])},children:[(0,b.jsx)("button",{type:"reset",style:{...e,backgroundColor:"#6c757d"},children:"Limpiar"}),(0,b.jsx)("input",{type:"text",name:"searchTerm",style:{flexGrow:1,padding:"0.5rem",borderRadius:"4px",border:"1px solid #ccc"},placeholder:"Buscar..."}),(0,b.jsx)("button",{type:"submit",style:e,children:"Buscar"})]})},l=({product:a,onQuantityChange:c,quantity:d})=>{let e={backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"5px",padding:"10px",cursor:"pointer",fontSize:"1rem",width:"40px",height:"40px",display:"flex",justifyContent:"center",alignItems:"center"};return(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,b.jsx)("button",{style:e,onClick:()=>c(a,d-1),children:"-"}),(0,b.jsx)("input",{type:"number",style:{width:"50px",textAlign:"center",fontSize:"1rem",padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},value:d,onChange:b=>c(a,parseInt(b.target.value,10)||0)}),(0,b.jsx)("button",{style:e,onClick:()=>c(a,d+1),children:"+"})]})},m=({product:a,selectedPrice:c,onPriceChange:d})=>(0,b.jsx)("select",{style:{padding:"8px",borderRadius:"4px",border:"1px solid #ccc",backgroundColor:"white",fontSize:"1rem",minWidth:"200px"},value:c.type,onChange:b=>{let c=b.target.value,e=a[c];d(a.id,{type:c,price:e})},children:[{value:"precioPublico",label:"Precio Publico"},{value:"precioComerciante",label:"Precio Comerciante"},{value:"preciox5sacos",label:"Precio x 5 sacos"},{value:"preciox10sacos",label:"Precio x 10 sacos"},{value:"preciox15sacos",label:"Precio x 15 sacos"}].map(c=>(0,b.jsxs)("option",{value:c.value,children:[c.label,": $",a[c.value]]},c.value))});var n=a.i(31073);let o=({selectedProducts:a,Card:c,onQuantityChange:d,onPriceChange:e,onRemoveProduct:f,handlerCrearPedido:g})=>{let h=a.filter(a=>a.quantity>0),i=h.reduce((a,{product:b,quantity:c})=>a+(b.selectedPrice?b.selectedPrice.price:b.precioPublico)*c,0);return 0===h.length?null:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:n.default.header,children:(0,b.jsx)("h2",{children:"Productos Seleccionados"})}),(0,b.jsxs)("div",{className:n.default.total,children:["Total General: $",i.toFixed(2)]}),(0,b.jsx)("div",{className:n.default.listContainer,children:h.map(({product:a,quantity:g})=>{let h=(a.selectedPrice?a.selectedPrice.price:a.precioPublico)*g;return(0,b.jsx)("div",{children:(0,b.jsxs)(c,{product:a,children:[(0,b.jsx)(m,{product:a,selectedPrice:a.selectedPrice||{type:"precioPublico",price:a.precioPublico},onPriceChange:e}),(0,b.jsxs)("div",{style:{textAlign:"right",display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,b.jsx)(l,{product:a,onQuantityChange:d,quantity:g}),(0,b.jsxs)("p",{className:n.default.totalProduct,children:["Subtotal: $",h.toFixed(2)]}),(0,b.jsx)("button",{onClick:()=>f(a),className:n.default.removeButton,children:"Quitar"})]})]})},a.id)})}),(0,b.jsx)("div",{className:n.default.header,style:{margin:"1rem 0"},children:(0,b.jsx)("button",{className:n.default.createOrderButton,onClick:g,children:"Crear pedido"})})]})},p=(0,f.getFirestore)(g.default),q=async(a,b)=>{try{let c=(0,f.doc)(p,"ingresos",a);return await (0,f.updateDoc)(c,{amount:(0,f.increment)(-b)}),{success:!0,message:`Amount updated for document ${a}`}}catch(a){return console.error("Error updating document:",a),{success:!1,error:a.message}}},r=(0,f.getFirestore)(g.default),s=async(a,b)=>{try{if(!Array.isArray(a)||0===a.length)throw Error("El pedido debe ser un array con al menos un producto.");let c=await (0,f.addDoc)((0,f.collection)(r,"pedidos"),{client:b,products:a,createdAt:(0,f.serverTimestamp)()});return{success:!0,id:c.id}}catch(a){return console.error("Error adding document: ",a),{success:!1,error:a.message}}},t=async(a,b)=>{console.log(a);try{if(!Array.isArray(a))return{success:!1,error:"newPedido must be an array"};let c=a.map(a=>a.product.id&&"number"==typeof a.quantity?q(a.product.id,a.quantity):Promise.reject(Error("Each item in newPedido must have an id and a numeric monto."))),d=await Promise.all(c);await s(a,b);let e=d.filter(a=>!a.success);if(e.length>0)return{success:!1,message:"Some updates failed",errors:e};return{success:!0,message:"All pedidos processed successfully"}}catch(a){return console.error("Error processing new pedido:",a),{success:!1,error:a.message}}};var u=a.i(93580);let v=({product:a,children:c})=>{let d={margin:"8px 0",color:"#333",fontSize:"1rem"},e={fontWeight:"bold"};return(0,b.jsxs)("div",{className:u.default.card,children:[(0,b.jsxs)("div",{className:u.default.info,children:[(0,b.jsxs)("p",{style:d,children:[(0,b.jsx)("span",{style:e,children:"Nombre:"})," ",a.nombre]}),(0,b.jsxs)("p",{style:d,children:[(0,b.jsx)("span",{style:e,children:"Peso:"})," ",a.peso]}),c[0]]}),(0,b.jsx)("div",{children:c[1]})]},a.id)};var w=a.i(26224);function x(){let[a,d]=(0,c.useState)(null),[f,g]=(0,c.useState)([]),[h,i]=(0,c.useState)(!1),[j,l]=(0,c.useState)(!1),[m,n]=(0,c.useState)(!1),p=(a,b)=>{let c=Math.max(0,b);g(b=>{let d=b.findIndex(b=>b.product.id===a.id),e=[...b];if(d>-1)c>0?e[d].quantity=c:e.splice(d,1);else if(c>0){let b="precioPublico",d=a[b];e.push({product:{...a,selectedPrice:{type:b,price:d}},quantity:c})}return e})},q=async()=>{let a=prompt("¿Para quién es este pedido?");if(a){n(!0);try{let b=await t(f,a);console.log(b),alert("Pedido creado con éxito!"),g([]),i(!1)}catch(a){console.error("Error al crear el pedido:",a),alert("Hubo un error al crear el pedido. Por favor, inténtalo de nuevo.")}finally{n(!1)}}},r={backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:"5px",padding:"10px 15px",cursor:"pointer",fontSize:"1rem",marginBottom:"1rem"};return(0,b.jsxs)("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",padding:"1rem 0",overflowY:"auto"},children:[m&&(0,b.jsx)(w.default,{}),(0,b.jsx)("div",{style:{flexGrow:1,overflowY:"auto",marginBottom:"3rem"},children:h?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{style:r,onClick:()=>i(!1),children:"Volver a Productos"}),(0,b.jsx)(o,{selectedProducts:f,Card:v,onQuantityChange:p,onPriceChange:(a,b)=>{g(c=>c.map(c=>c.product.id===a?{...c,product:{...c.product,selectedPrice:b}}:c))},onRemoveProduct:a=>{window.confirm(`\xbfEst\xe1s seguro de que quieres quitar ${a.nombre} de la lista?`)&&p(a,0)},handlerCrearPedido:q})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsx)("h1",{children:"Productos Disponibles"}),(0,b.jsxs)("button",{style:r,onClick:()=>i(!0),children:["Ver Seleccionados (",f.reduce((a,b)=>a+b.quantity,0),")"]})]}),j?(0,b.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh"},children:(0,b.jsx)(w.default,{})}):(0,b.jsx)(e,{products:a,Card:v,onQuantityChange:p,selectedProducts:f})]})}),!h&&(0,b.jsx)("div",{style:{padding:"1rem 0",width:"100%",position:"fixed",bottom:0},children:(0,b.jsx)(k,{onSearchResults:d,setIsLoading:l})})]})}a.s(["default",()=>x],85690)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__4b5f1f67._.js.map